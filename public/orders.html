<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <title>Cointology - Admin Panel </title>
    <link rel="stylesheet" href="css/admin.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
   </head>
<body>
  <div class="sidebar">
    <div class="logo-details">
      <i class='bx bxl-c-plus-plus icon'></i>
        <div class="logo_name">Cointology</div>
        <i class='bx bx-menu' id="btn" ></i>
    </div>
    <ul class="nav-list">
      <li>
        <a href="dashboard.html">
          <i class='bx bx-grid-alt'></i>
          <span class="links_name">Dashboard</span>
        </a>
         <span class="tooltip">Dashboard</span>
      </li>
      <li>
       <a href="players.html">
         <i class='bx bx-user' ></i>
         <span class="links_name">Products</span>
       </a>
       <span class="tooltip">Products</span>
     </li>
     <li>
       <a href="matches.html">
        <i class='bx bx-stats'></i>
         <span class="links_name">Orders</span>
       </a>
       <span class="tooltip">Orders</span>
     </li>
     <li>
       <a href="table.html">
        <i class='bx bx-table'></i>
         <span class="links_name">Revenue</span>
       </a>
       <span class="tooltip">Revenue</span>
     </li>
     <li>
       <a href="teamgenerator.html">
        <i class='bx bxl-microsoft-teams'></i>
         <span class="links_name">Refunds</span>
       </a>
       <span class="tooltip">Refunds</span>
     </li>
     <li>
       <a href="awards.html">
        <i class='bx bx-award'></i>
         <span class="links_name">Deliveries</span>
       </a>
       <span class="tooltip">Deliveries</span>
     </li>
     <li>
       <a href="comingsoon.html">
        <i class='bx bx-video-recording' ></i>
         <span class="links_name">Updates</span>
       </a>
       <span class="tooltip">Updates</span>
     </li>
     <li>
       <a href="compare.html">
        <i class='bx bx-git-compare'></i>
        <span class="links_name">Contact</span>
       </a>
       <span class="tooltip">Contact</span>
     </li>
    </ul>
  </div>
  <section class="home-section">
      <div class="top-container">
        <div class="big-text">Orders</div>
        <button class="add-product">Add a Product</button>
      </div>

    <div class="orders-container">
      
    </div>
      



  </section>


<script src="menu.js"></script>
<script src="orders.js"></script>
<script>
  // Function to fetch and render orders from the server
  function fetchAndRenderOrders() {
    fetch('/api/orders')
      .then(response => {
        if (!response.ok) {
          throw new Error('Error fetching orders');
        }
        return response.json();
      })
      .then(orders => {
        renderOrdersTable(orders);
      })
      .catch(error => {
        console.error('Error fetching orders:', error.message);
      });
  }

  function renderOrdersTable(orders) {
  const orderContainer = document.querySelector(".orders-container");
  const orderCardsHTML = orders.map(order => `
    <div class="order-card">
      <div class="order-details-container">
        <p>${order.id}</p>
        <p>${new Date().toLocaleString()}</p>
        <p>${order.customer_email}</p>
      </div>
      <div class="info-container">
        <h2>Total: 21.99 Status: PAID</h2>
      </div>
      <div class="view-stats"><i class="bx bxs-up-arrow-circle"></i>View Order Information</div>
      <div class="full-order">
        <div class="title">Customer Details</div>
        <div class="customer-add-container order-gap">
          <div class="house">Name: ${order.customer_name}</div>
          <div class="street">Email: ${order.customer_email}</div>
          <div class="city">Phone: ${order.customer_phone}</div>
        </div>
        <br>
        <div class="title">Customer Address</div>
        <div class="customer-add-container order-gap">
          <div class="house">${order.customer_address.line1}</div>
          <div class="street">${order.customer_address.city}</div>
          <div class="city">${order.customer_address.postal_code}</div>
          <div class="post-code">${order.customer_address.country}</div>
        </div>
        <br>
        <div class="title">Order Receipt</div>
        <div class="items-container item-container">
          ${renderLineItems(order.lineItems)}
        </div>
        <div class="items-container order-gap">
          <div class="total">Total</div>
          <div class="total">£${(order.totalPrice / 100).toFixed(2)}</div>
        </div>
        <div class="action container">
          <button>Delete Order</button>
          <button>Refunds</button>
          <button>Contact Customer</button>
        </div>
      </div>
    </div>
  `).join(''); // Use join to concatenate the array into a string

  orderContainer.innerHTML = orderCardsHTML;
}

function renderLineItems(lineItems) {
  return lineItems.map(item => `<div>${item.quantity} x ${item.name} | £${(item.unitPrice * item.quantity) / 100}</div>`).join('');
}


  // Periodically fetch and render orders (adjust the interval as needed)
  setInterval(fetchAndRenderOrders, 5000);

  // Initial fetch and render on page load
  fetchAndRenderOrders();

</script>
</body>
</html>